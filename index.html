<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constitution of Nepal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.7;
            color: #000;
            background: #fff;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        header {
            border-bottom: 3px solid #000;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
        }

        .controls {
            border-bottom: 2px solid #000;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #000;
            font-family: inherit;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            background: #f5f5f5;
        }

        .lang-toggle {
            display: flex;
            gap: 0;
            border: 2px solid #000;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-right: 2px solid #000;
            background: #fff;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        button:last-child {
            border-right: none;
        }

        button:hover {
            background: #f5f5f5;
        }

        button.active {
            background: #000;
            color: #fff;
        }

        .preamble {
            border: 3px solid #000;
            padding: 2rem;
            margin-bottom: 3rem;
            background: #f9f9f9;
        }

        .preamble-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .preamble-text {
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .preamble-text.nepali {
            font-size: 1.05rem;
        }

        .part {
            margin-bottom: 4rem;
        }

        .part-header {
            background: #000;
            color: #fff;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
        }

        .part-number {
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.8;
        }

        .part-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 0.5rem;
        }

        .article {
            margin-bottom: 3rem;
            padding-left: 2rem;
            border-left: 3px solid #000;
        }

        .article-header {
            margin-bottom: 1.5rem;
        }

        .article-number {
            font-weight: 700;
            font-size: 1.3rem;
        }

        .article-title {
            font-size: 1.1rem;
            margin-top: 0.5rem;
            color: #333;
        }

        .article-content {
            margin-top: 1rem;
        }

        .subsection {
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .subsection.nepali {
            font-size: 1.05rem;
        }

        .subsection.english {
            color: #444;
            padding-left: 1rem;
            border-left: 3px solid #999;
            margin-top: 1rem;
        }

        .sentence-pair {
            margin-bottom: 1.5rem;
            display: grid;
            gap: 1rem;
        }

        .sentence {
            padding: 0.75rem;
            border-left: 4px solid #000;
        }

        .sentence.nepali {
            background: #f5f5f5;
            font-size: 1.05rem;
        }

        .sentence.english {
            background: #fafafa;
            border-left-color: #999;
            color: #444;
        }

        .subsection-header {
            font-weight: 700;
            font-size: 1.1rem;
            margin: 2rem 0 1rem 0;
        }

        .subsection-id {
            font-weight: 700;
            margin-right: 0.5rem;
        }

        .sub-subsection {
            margin-left: 2rem;
            margin-top: 0.75rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .part-title {
                font-size: 1.5rem;
            }

            .article {
                padding-left: 1rem;
            }
        }

        @media print {
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Constitution of Nepal</h1>
        <div class="subtitle">नेपालको संविधान</div>
    </header>

    <div class="controls">
        <div class="search-box">
            <input type="text" id="search" placeholder="Search articles...">
        </div>
        <div class="lang-toggle">
            <button class="active" data-lang="both">Both</button>
            <button data-lang="nepali">नेपाली</button>
            <button data-lang="english">English</button>
        </div>
        <div class="lang-toggle">
            <button class="active" data-view="paragraph">Paragraph</button>
            <button data-view="sentence">Sentence</button>
        </div>
    </div>

    <main id="content" class="loading">
        Loading constitution...
    </main>

    <script>
        let paragraphData = null;
        let sentenceData = null;
        let currentLang = 'both';
        let currentView = 'paragraph';

        // Load both JSON files
        Promise.all([
            fetch('constitution_bilingual.json').then(res => res.json()),
            fetch('per-sentence.json').then(res => res.json())
        ])
            .then(([paragraph, sentence]) => {
                paragraphData = paragraph;
                sentenceData = sentence;
                render();
            })
            .catch(err => {
                document.getElementById('content').innerHTML = '<p>Error loading constitution data.</p>';
                console.error(err);
            });

        function render() {
            if (currentView === 'paragraph') {
                renderParagraphView();
            } else {
                renderSentenceView();
            }
        }

        function renderParagraphView() {
            const container = document.getElementById('content');
            container.innerHTML = '';

            const constitution = paragraphData.constitution;

            // Preamble
            if (constitution.preamble) {
                const preambleDiv = document.createElement('div');
                preambleDiv.className = 'preamble';
                preambleDiv.id = 'preamble';

                const title = document.createElement('div');
                title.className = 'preamble-title';
                title.textContent = 'Preamble / प्रस्तावना';
                preambleDiv.appendChild(title);

                if (constitution.preamble.np && currentLang !== 'english') {
                    const npText = document.createElement('div');
                    npText.className = 'preamble-text nepali';
                    npText.textContent = constitution.preamble.np;
                    preambleDiv.appendChild(npText);
                }

                if (constitution.preamble.en && currentLang !== 'nepali') {
                    const enText = document.createElement('div');
                    enText.className = 'preamble-text english';
                    enText.textContent = constitution.preamble.en;
                    preambleDiv.appendChild(enText);
                }

                container.appendChild(preambleDiv);
            }

            // Parts
            constitution.parts.forEach(part => {
                const partDiv = document.createElement('div');
                partDiv.className = 'part';
                partDiv.id = `part-${part.number}`;

                const header = document.createElement('div');
                header.className = 'part-header';

                const partNum = document.createElement('div');
                partNum.className = 'part-number';
                partNum.textContent = `Part ${part.number}`;
                header.appendChild(partNum);

                const partTitle = document.createElement('div');
                partTitle.className = 'part-title';
                const titleNp = part.title.np || '';
                const titleEn = part.title.en || '';

                if (currentLang === 'both') {
                    partTitle.textContent = titleNp && titleEn ? `${titleNp} / ${titleEn}` : titleNp || titleEn;
                } else if (currentLang === 'nepali') {
                    partTitle.textContent = titleNp;
                } else {
                    partTitle.textContent = titleEn;
                }

                header.appendChild(partTitle);
                partDiv.appendChild(header);

                // Articles
                part.articles.forEach(article => {
                    const articleDiv = document.createElement('div');
                    articleDiv.className = 'article';

                    const articleHeader = document.createElement('div');
                    articleHeader.className = 'article-header';

                    const articleNum = document.createElement('div');
                    articleNum.className = 'article-number';
                    articleNum.textContent = article.number;
                    articleHeader.appendChild(articleNum);

                    const articleTitle = document.createElement('div');
                    articleTitle.className = 'article-title';
                    const titleNp = article.title.np || '';
                    const titleEn = article.title.en || '';

                    if (currentLang === 'both') {
                        articleTitle.textContent = titleNp && titleEn ? `${titleNp} / ${titleEn}` : titleNp || titleEn;
                    } else if (currentLang === 'nepali') {
                        articleTitle.textContent = titleNp;
                    } else {
                        articleTitle.textContent = titleEn;
                    }

                    articleHeader.appendChild(articleTitle);
                    articleDiv.appendChild(articleHeader);

                    // Content
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'article-content';
                    renderArticleContent(article.content, contentDiv);

                    articleDiv.appendChild(contentDiv);
                    partDiv.appendChild(articleDiv);
                });

                container.appendChild(partDiv);
            });
        }

        // Render article content
        function renderArticleContent(content, container) {
            // Nepali content
            if (content.np && content.np.length > 0 && currentLang !== 'english') {
                content.np.forEach(item => {
                    const subsectionDiv = document.createElement('div');
                    subsectionDiv.className = 'subsection nepali';

                    if (item.type === 'subsection') {
                        const id = document.createElement('span');
                        id.className = 'subsection-id';
                        id.textContent = item.identifier;
                        subsectionDiv.appendChild(id);

                        const text = document.createTextNode(' ' + item.text);
                        subsectionDiv.appendChild(text);

                        if (item.items && item.items.length > 0) {
                            item.items.forEach(subItem => {
                                const subDiv = document.createElement('div');
                                subDiv.className = 'sub-subsection';

                                const subId = document.createElement('span');
                                subId.className = 'subsection-id';
                                subId.textContent = subItem.identifier;
                                subDiv.appendChild(subId);

                                const subText = document.createTextNode(' ' + subItem.text);
                                subDiv.appendChild(subText);

                                subsectionDiv.appendChild(subDiv);
                            });
                        }
                    } else if (item.type === 'text') {
                        subsectionDiv.textContent = item.text;
                    }

                    container.appendChild(subsectionDiv);
                });
            }

            // English content
            if (content.en && content.en.length > 0 && currentLang !== 'nepali') {
                content.en.forEach(item => {
                    const subsectionDiv = document.createElement('div');
                    subsectionDiv.className = 'subsection english';

                    if (item.type === 'subsection') {
                        const id = document.createElement('span');
                        id.className = 'subsection-id';
                        id.textContent = item.identifier;
                        subsectionDiv.appendChild(id);

                        const text = document.createTextNode(' ' + item.text);
                        subsectionDiv.appendChild(text);

                        if (item.items && item.items.length > 0) {
                            item.items.forEach(subItem => {
                                const subDiv = document.createElement('div');
                                subDiv.className = 'sub-subsection';

                                const subId = document.createElement('span');
                                subId.className = 'subsection-id';
                                subId.textContent = subItem.identifier;
                                subDiv.appendChild(subId);

                                const subText = document.createTextNode(' ' + subItem.text);
                                subDiv.appendChild(subText);

                                subsectionDiv.appendChild(subDiv);
                            });
                        }
                    } else if (item.type === 'text') {
                        subsectionDiv.textContent = item.text;
                    }

                    container.appendChild(subsectionDiv);
                });
            }
        }

        function renderSentenceView() {
            const container = document.getElementById('content');
            container.innerHTML = '';

            const constitution = sentenceData.constitution;

            // Preamble
            if (constitution.preamble && constitution.preamble.aligned_sentences) {
                const preambleDiv = document.createElement('div');
                preambleDiv.className = 'preamble';
                preambleDiv.id = 'preamble';

                const title = document.createElement('div');
                title.className = 'preamble-title';
                title.textContent = 'Preamble / प्रस्तावना';
                preambleDiv.appendChild(title);

                constitution.preamble.aligned_sentences.forEach(pair => {
                    const pairDiv = document.createElement('div');
                    pairDiv.className = 'sentence-pair';

                    if (pair.np && currentLang !== 'english') {
                        const npDiv = document.createElement('div');
                        npDiv.className = 'sentence nepali';
                        npDiv.textContent = pair.np;
                        pairDiv.appendChild(npDiv);
                    }

                    if (pair.en && currentLang !== 'nepali') {
                        const enDiv = document.createElement('div');
                        enDiv.className = 'sentence english';
                        enDiv.textContent = pair.en;
                        pairDiv.appendChild(enDiv);
                    }

                    preambleDiv.appendChild(pairDiv);
                });

                container.appendChild(preambleDiv);
            }

            // Parts
            constitution.parts.forEach(part => {
                const partDiv = document.createElement('div');
                partDiv.className = 'part';
                partDiv.id = `part-${part.number}`;

                const header = document.createElement('div');
                header.className = 'part-header';

                const partNum = document.createElement('div');
                partNum.className = 'part-number';
                partNum.textContent = `Part ${part.number}`;
                header.appendChild(partNum);

                const partTitle = document.createElement('div');
                partTitle.className = 'part-title';
                const titleNp = part.title.np || '';
                const titleEn = part.title.en || '';

                if (currentLang === 'both') {
                    partTitle.textContent = titleNp && titleEn ? `${titleNp} / ${titleEn}` : titleNp || titleEn;
                } else if (currentLang === 'nepali') {
                    partTitle.textContent = titleNp;
                } else {
                    partTitle.textContent = titleEn;
                }

                header.appendChild(partTitle);
                partDiv.appendChild(header);

                // Articles
                part.articles.forEach(article => {
                    const articleDiv = document.createElement('div');
                    articleDiv.className = 'article';

                    const articleHeader = document.createElement('div');
                    articleHeader.className = 'article-header';

                    const articleNum = document.createElement('div');
                    articleNum.className = 'article-number';
                    articleNum.textContent = article.number;
                    articleHeader.appendChild(articleNum);

                    const articleTitle = document.createElement('div');
                    articleTitle.className = 'article-title';
                    const titleNp = article.title.np || '';
                    const titleEn = article.title.en || '';

                    if (currentLang === 'both') {
                        articleTitle.textContent = titleNp && titleEn ? `${titleNp} / ${titleEn}` : titleNp || titleEn;
                    } else if (currentLang === 'nepali') {
                        articleTitle.textContent = titleNp;
                    } else {
                        articleTitle.textContent = titleEn;
                    }

                    articleHeader.appendChild(articleTitle);
                    articleDiv.appendChild(articleHeader);

                    // Content
                    article.content.forEach(item => {
                        if (item.identifier) {
                            const subsecHeader = document.createElement('div');
                            subsecHeader.className = 'subsection-header';
                            subsecHeader.textContent = item.identifier;
                            articleDiv.appendChild(subsecHeader);
                        }

                        if (item.aligned_sentences) {
                            item.aligned_sentences.forEach(pair => {
                                const pairDiv = document.createElement('div');
                                pairDiv.className = 'sentence-pair';

                                if (pair.np && currentLang !== 'english') {
                                    const npDiv = document.createElement('div');
                                    npDiv.className = 'sentence nepali';
                                    npDiv.textContent = pair.np;
                                    pairDiv.appendChild(npDiv);
                                }

                                if (pair.en && currentLang !== 'nepali') {
                                    const enDiv = document.createElement('div');
                                    enDiv.className = 'sentence english';
                                    enDiv.textContent = pair.en;
                                    pairDiv.appendChild(enDiv);
                                }

                                articleDiv.appendChild(pairDiv);
                            });
                        }
                    });

                    partDiv.appendChild(articleDiv);
                });

                container.appendChild(partDiv);
            });
        }

        // Language toggle
        document.querySelectorAll('.lang-toggle button[data-lang]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-toggle button[data-lang]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentLang = btn.dataset.lang;
                render();
            });
        });

        // View mode toggle
        document.querySelectorAll('.lang-toggle button[data-view]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-toggle button[data-view]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                render();
            });
        });

        // Search
        document.getElementById('search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const articles = document.querySelectorAll('.article');

            articles.forEach(article => {
                const text = article.textContent.toLowerCase();
                article.style.display = text.includes(query) ? 'block' : 'none';
            });

            const preamble = document.getElementById('preamble');
            if (preamble) {
                const text = preamble.textContent.toLowerCase();
                preamble.style.display = text.includes(query) ? 'block' : 'none';
            }
        });
    </script>
</body>
</html>
